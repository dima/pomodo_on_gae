<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" height="400" width="300" 
  xmlns:validators="org.ruboss.validators.*">
  <mx:Metadata>
    [Event(name="login", type="flash.events.Event")]
  </mx:Metadata>
  <mx:Script>
    <![CDATA[
      import mx.core.Application;
      import org.ruboss.Ruboss;
      import pomodo.models.Account;
      
      private function login():void {
        Ruboss.http({onResult: onLoginSuccess, onFault: onLoginFailure}).invoke("session.fxml", 
          { login: userTI.text, password: passwordTI.text }, "POST");
      }
      
      private function onLoginSuccess(result:Object):void {
        Ruboss.defaultMetadata = { 'Auth' : XML(result).toString() };
        dispatchEvent(new Event("login"));
      }
      
      private function onLoginFailure(result:Object):void {
        loginForm.errorString = "Wrong username or password. Try again.";
      }

      private function loginOnEnter(event:KeyboardEvent):void {
        if (event.keyCode == 13) {
          login();
        }
      }
    ]]>    
  </mx:Script>

  <mx:ViewStack height="100%" width="100%" id="views">
    <mx:Canvas id="loginView" width="100%" height="100%">
      <mx:Form verticalCenter="0" horizontalCenter="0" id="loginForm" borderStyle="solid">
        <mx:Canvas backgroundColor="#000000" width="100%" height="50">
          <mx:Label text="Pomodo / Welcome" styleName="appTitle" x="4" y="2" selectable="false"/>
          <mx:Label text="Agile time tracking for everyone" styleName="appDescription" x="4" y="27" selectable="false"/>
        </mx:Canvas>
        <mx:FormItem label="Username">
          <mx:TextInput width="190" id="userTI"/>
        </mx:FormItem>
        <mx:FormItem label="Password">
          <mx:TextInput width="190" displayAsPassword="true" id="passwordTI" keyDown="loginOnEnter(event)"/>
        </mx:FormItem>
        <mx:FormItem label="">
          <mx:Button label="Login" click="login()" keyDown="loginOnEnter(event)"/>  
        </mx:FormItem>
      </mx:Form>
    </mx:Canvas>
  </mx:ViewStack>
</mx:Canvas>